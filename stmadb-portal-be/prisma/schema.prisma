// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============== MODUL 1: PENGGUNA & AKSES ==============

model Role {
  id        Int      @id @default(autoincrement())
  role_name String   @unique @db.VarChar(50)
  users     User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id         Int       @id @default(autoincrement())
  email      String    @unique
  password   String
  is_active  Boolean   @default(true)
  last_login DateTime?
  roles      Role[]

  profile             Profile?
  teacher_extension   TeacherExtension?
  student_extension   StudentExtension?
  guardian_extension  GuardianExtension?
  duties              DutySchedule[]
  homeroom_class      Classes?            @relation("HomeroomTeacher")
  teacher_assignments TeacherAssignment[]
  teaching_journals   TeachingJournal[]
  class_memberships   ClassMember[]

  // --- PERUBAHAN DI SINI ---
  // Relasi ke absensi harian (sebagai siswa)
  student_attendances      StudentAttendance[]
  // Relasi untuk guru/staf yang membuat QR harian
  generated_daily_sessions DailyAttendanceSession[] @relation("GeneratedBy")
  // --- AKHIR PERUBAHAN ---

  leave_permits_requested LeavePermit[]   @relation("Requester")
  leave_permits_approved  LeaveApproval[] @relation("Approver")
  leave_permits_printed   LeavePermit[]   @relation("PrintedBy")

  counseling_tickets_as_student   CounselingTicket[] @relation("StudentCounseling")
  counseling_tickets_as_counselor CounselingTicket[] @relation("CounselorTickets")

  // PKL Relations
  pkl_assignments_as_student    PKLAssignment[] @relation("PKLStudent")
  pkl_assignments_as_supervisor PKLAssignment[] @relation("PKLSchoolSupervisor")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Profile {
  id              Int       @id @default(autoincrement())
  full_name       String
  identity_number String?   @unique
  gender          Gender
  address         String?   @db.Text
  phone_number    String?
  photo_url       String?
  birth_date      DateTime?

  user_id Int  @unique
  user    User @relation(fields: [user_id], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Gender {
  Laki_laki
  Perempuan
}

enum EmploymentStatus {
  PNS
  PPPK
  GTT
}

model TeacherExtension {
  id      Int               @id @default(autoincrement())
  user_id Int               @unique
  user    User              @relation(fields: [user_id], references: [id])
  nip     String?           @unique
  status  EmploymentStatus?
}

model StudentExtension {
  id          Int                @id @default(autoincrement())
  user_id     Int                @unique
  user        User               @relation(fields: [user_id], references: [id])
  nisn        String             @unique
  guardian_id Int?
  guardian    GuardianExtension? @relation(fields: [guardian_id], references: [id])
  slim_id     String?            @unique
}

model GuardianExtension {
  id         Int                @id @default(autoincrement())
  user_id    Int                @unique
  user       User               @relation(fields: [user_id], references: [id])
  occupation String?
  students   StudentExtension[]
}

// ============== MODUL 2: STRUKTUR AKADEMIK & JADWAL ==============

model AcademicYear {
  id                   Int                  @id @default(autoincrement())
  year                 String               @unique
  start_date           DateTime
  end_date             DateTime
  is_active            Boolean              @default(false)
  class_memberships    ClassMember[]
  teacher_assignments  TeacherAssignment[]
  schedules            Schedule[]
  academic_weeks       AcademicWeek[]
  special_events       SpecialEvent[]
  active_schedule_week ActiveScheduleWeek[]

  // Relasi baru ke absensi harian
  daily_attendance_sessions DailyAttendanceSession[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Major {
  id         Int       @id @default(autoincrement())
  major_name String    @unique
  major_code String    @unique
  classes    Classes[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Classes {
  id                        Int                      @id @default(autoincrement())
  class_name                String                   @unique
  grade_level               Int
  major_id                  Int
  major                     Major                    @relation(fields: [major_id], references: [id])
  homeroom_teacher_id       Int?                     @unique
  homeroom_teacher          User?                    @relation("HomeroomTeacher", fields: [homeroom_teacher_id], references: [id])
  class_members             ClassMember[]
  teacher_assignments       TeacherAssignment[]
  daily_attendance_sessions DailyAttendanceSession[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Subject {
  id                  Int                 @id @default(autoincrement())
  subject_name        String
  subject_code        String              @unique
  teacher_assignments TeacherAssignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AcademicWeek {
  id               Int          @id @default(autoincrement())
  start_date       DateTime     @db.Date
  end_date         DateTime     @db.Date
  week_type        WeekType
  notes            String?
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])
}

enum WeekType {
  A
  B
  Libur
  Ujian
  Acara
}

model Schedule {
  id               Int               @id @default(autoincrement())
  day_of_week      DayOfWeek
  start_time       DateTime          @db.Time
  end_time         DateTime          @db.Time
  schedule_type    ScheduleType      @default(Umum)
  assignment_id    Int
  assignment       TeacherAssignment @relation(fields: [assignment_id], references: [id])
  academic_year_id Int
  academic_year    AcademicYear      @relation(fields: [academic_year_id], references: [id])
  journals         TeachingJournal[]
  leave_permits    LeavePermit[]
  room_id          Int?
  room             Room?             @relation(fields: [room_id], references: [id])

  // --- PERUBAHAN DI SINI ---
  // qr_sessions         AttendanceQRSession[] // <-- DIHAPUS
  // --- AKHIR PERUBAHAN ---
}

enum DayOfWeek {
  Senin
  Selasa
  Rabu
  Kamis
  Jumat
}

enum ScheduleType {
  A
  B
  Umum
}

model SpecialEvent {
  id               Int          @id @default(autoincrement())
  event_name       String
  description      String?
  start_date       DateTime     @db.Date
  end_date         DateTime     @db.Date
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])
}

model ActiveScheduleWeek {
  id               Int          @id @default(autoincrement())
  grade_level      Int // 10, 11, 12 (untuk X, XI, XII)
  active_week_type ScheduleType @default(Umum) // A, B, atau Umum
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])
  updated_at       DateTime     @updatedAt

  @@unique([grade_level, academic_year_id])
}

model DutySchedule {
  id        Int      @id @default(autoincrement())
  user_id   Int
  user      User     @relation(fields: [user_id], references: [id])
  duty_date DateTime @db.Date
  duty_type String
  notes     String?

  @@unique([user_id, duty_date, duty_type])
}

model ClassMember {
  id               Int          @id @default(autoincrement())
  student_user_id  Int
  student          User         @relation(fields: [student_user_id], references: [id])
  class_id         Int
  class            Classes      @relation(fields: [class_id], references: [id])
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])

  @@unique([student_user_id, academic_year_id])
}

model TeacherAssignment {
  id               Int          @id @default(autoincrement())
  teacher_user_id  Int
  teacher          User         @relation(fields: [teacher_user_id], references: [id])
  subject_id       Int
  subject          Subject      @relation(fields: [subject_id], references: [id])
  class_id         Int
  class            Classes      @relation(fields: [class_id], references: [id])
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])
  schedules        Schedule[]
}

// ============== MODUL 2.5: HARI LIBUR ==============

model Holiday {
  id          Int      @id @default(autoincrement())
  name        String // Nama hari libur (e.g., "Hari Raya Idul Fitri", "Libur Semester")
  date        DateTime @db.Date
  description String?  @db.Text
  is_active   Boolean  @default(true) // Aktif/Nonaktif

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date])
}

// ============== MODUL 3: ABSENSI HARIAN (BARU) ==============

// Model ini menggantikan AttendanceQRSession
// Ini adalah sesi harian yang unik per KELAS per hari
model DailyAttendanceSession {
  id           String   @id @default(uuid())
  session_date DateTime @db.Date
  qr_code      String   @unique

  // QR code dibuat per KELAS
  class_id Int
  class    Classes @relation(fields: [class_id], references: [id])

  // Waktu kedaluwarsa QR
  expires_at DateTime

  // ID Guru Piket/Admin/Guru yang generate QR
  created_by_id Int
  creator       User @relation("GeneratedBy", fields: [created_by_id], references: [id])

  // Terikat ke tahun ajaran aktif
  academic_year_id Int
  academic_year    AcademicYear @relation(fields: [academic_year_id], references: [id])

  // Semua absensi siswa untuk hari ini (di kelas ini) akan merujuk ke sini
  student_attendances StudentAttendance[]

  // Relasi ke jurnal KBM yang merujuk ke sesi harian ini
  teaching_journals TeachingJournal[]

  createdAt DateTime @default(now())

  // Kunci unik: 1 sesi per kelas per hari
  @@unique([session_date, class_id])
  @@index([created_by_id])
  @@index([academic_year_id])
  @@index([class_id])
}

// Model ini dimodifikasi untuk absensi harian
model StudentAttendance {
  id Int @id @default(autoincrement())

  // Link ke Sesi Harian (menggantikan qr_session_id)
  daily_session_id String
  daily_session    DailyAttendanceSession @relation(fields: [daily_session_id], references: [id], onDelete: Cascade)

  student_user_id Int
  student         User @relation(fields: [student_user_id], references: [id])

  status      AttendanceStatus @default(Hadir)
  scan_method String // "QR" atau "Manual" (sesuai permintaan Anda)

  // Waktu kapan siswa scan atau guru input manual
  marked_at DateTime @default(now())

  // Untuk fitur 'validasi guru lain' (WaliKelas/BK)
  is_verified    Boolean @default(false)
  verified_by_id Int? // ID guru yang memvalidasi

  notes String?

  // Kunci unik baru: Siswa hanya bisa absen 1x per sesi harian
  @@unique([daily_session_id, student_user_id])
  @@index([student_user_id])
}

// Model `AttendanceQRSession` (lama) telah dihapus

// ============== MODUL 4: JURNAL MENGAJAR ==============

model TeachingJournal {
  id              Int      @id @default(autoincrement())
  journal_date    DateTime @db.Date
  schedule_id     Int
  schedule        Schedule @relation(fields: [schedule_id], references: [id])
  teacher_user_id Int
  teacher         User     @relation(fields: [teacher_user_id], references: [id])

  // Status Guru
  teacher_status       String  @default("Hadir") // Hadir, Sakit, Izin, Alpa
  teacher_status_notes String? @db.Text // Alasan jika tidak hadir

  // Konten Jurnal (Jika Hadir)
  material_topic       String? // Topik materi pembelajaran
  material_description String? @db.Text // Deskripsi detail materi
  learning_method      String? // Ceramah, Diskusi, Praktik, dll
  learning_media       String? // Slides, Video, Modul, dll
  learning_achievement String? @db.Text // Capaian pembelajaran siswa
  teacher_notes        String? @db.Text // Catatan tambahan guru
  reflection_notes     String? @db.Text // Catatan refleksi hasil pembelajaran (100-500 karakter)

  // Link ke Daily Attendance Session (read-only dari sistem absensi harian yang sudah ada)
  // Jurnal akan fetch data absensi dari DailyAttendanceSession berdasarkan kelas & tanggal
  daily_session_id String? // Optional: Link ke sesi absensi harian
  daily_session    DailyAttendanceSession? @relation(fields: [daily_session_id], references: [id])

  // Relations
  photos JournalPhoto[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([schedule_id, journal_date])
  @@index([teacher_user_id])
  @@index([schedule_id])
  @@index([journal_date])
  @@index([daily_session_id])
}

model JournalPhoto {
  id         Int             @id @default(autoincrement())
  journal_id Int
  journal    TeachingJournal @relation(fields: [journal_id], references: [id], onDelete: Cascade)

  photo_url String // URL foto
  filename  String // Nama asli file
  file_size Int? // Ukuran file dalam bytes

  createdAt DateTime @default(now())

  @@index([journal_id])
}

// JournalStudentAttendance DIHAPUS - Jurnal hanya READ data dari DailyAttendanceSession
// Tidak ada duplikasi data absensi

// Enum ini dipakai oleh StudentAttendance dan Attendance (legacy)
enum AttendanceStatus {
  Hadir
  Izin
  Sakit
  Alfa
}

// Model legacy (dibiarkan sesuai permintaan)
model Attendance {
  id         Int              @id @default(autoincrement())
  status     AttendanceStatus @default(Hadir)
  notes      String?
  journal_id Int
  // Note: This uses journal_id but TeachingJournal now uses StudentAttendance instead
  // Kept for backward compatibility
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
}

model Room {
  id        Int        @id @default(autoincrement())
  room_name String
  room_code String     @unique
  schedules Schedule[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============== MODUL 5: IZIN KELUAR SEKOLAH ==============
// (Tidak ada perubahan di modul ini)

enum RequesterType {
  Student
  Teacher
}

enum LeavePermitType {
  Individual
  Group
}

enum LeavePermitStatus {
  WaitingForPiket
  WaitingForApproval
  Approved
  Rejected
  Completed
}

enum ApprovalStatus {
  Pending
  Approved
  Rejected
}

model LeavePermit {
  id                  Int               @id @default(autoincrement())
  requester_user_id   Int
  requester           User              @relation("Requester", fields: [requester_user_id], references: [id])
  requester_type      RequesterType     @default(Student)
  leave_type          LeavePermitType
  reason              String            @db.Text
  start_time          DateTime          @db.Timestamp()
  estimated_return    DateTime?         @db.Timestamp()
  status              LeavePermitStatus @default(WaitingForPiket)
  approvals           LeaveApproval[]
  related_schedule_id Int?
  related_schedule    Schedule?         @relation(fields: [related_schedule_id], references: [id])
  group_members       Json?
  printed_by_id       Int?
  printed_by          User?             @relation("PrintedBy", fields: [printed_by_id], references: [id])
  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  @@index([requester_user_id])
  @@index([printed_by_id])
  @@index([requester_type])
}

model LeaveApproval {
  id               Int            @id @default(autoincrement())
  leave_permit_id  Int
  leave_permit     LeavePermit    @relation(fields: [leave_permit_id], references: [id])
  approver_user_id Int
  approver         User           @relation("Approver", fields: [approver_user_id], references: [id])
  approver_role    String
  status           ApprovalStatus @default(Pending)
  notes            String?        @db.Text
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  @@unique([leave_permit_id, approver_user_id])
  @@index([approver_user_id])
}

// ============== MODUL 6: E-COUNSELING ==============
// (Tidak ada perubahan di modul ini)

enum CounselingTicketStatus {
  OPEN
  PROSES
  DITOLAK
  CLOSE
}

model CounselingTicket {
  id                  Int                    @id @default(autoincrement())
  ticket_number       String                 @unique // Format: EC-2025-0001
  student_user_id     Int
  student             User                   @relation("StudentCounseling", fields: [student_user_id], references: [id])
  counselor_user_id   Int
  counselor           User                   @relation("CounselorTickets", fields: [counselor_user_id], references: [id])
  preferred_date      DateTime               @db.Date
  preferred_time      DateTime               @db.Time
  problem_description String                 @db.Text
  status              CounselingTicketStatus @default(OPEN)
  confirmed_schedule  DateTime?              @db.Timestamp()
  rejection_reason    String?                @db.Text
  counseling_notes    String?                @db.Text
  completion_notes    String?                @db.Text
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt

  @@index([student_user_id])
  @@index([counselor_user_id])
  @@index([status])
}

// ============== MODUL 7: PKL (PRAKTIK KERJA LAPANGAN) ==============

// 1. Master Data Industry/Perusahaan
model Industry {
  id Int @id @default(autoincrement())

  // Data Perusahaan
  company_name String  @unique
  company_code String? @unique
  address      String  @db.Text
  phone        String?
  email        String?
  website      String?

  // Geolocation untuk validasi GPS
  latitude      Decimal @db.Decimal(10, 8) // -90 to 90
  longitude     Decimal @db.Decimal(11, 8) // -180 to 180
  radius_meters Int     @default(100) // Radius validasi dalam meter

  // Data Tambahan
  industry_type String? // Manufaktur, IT, Perhotelan, dll
  description   String? @db.Text

  // Contact Person dari Perusahaan
  contact_person_name  String?
  contact_person_phone String?
  contact_person_email String?

  // Status
  is_active Boolean @default(true)

  // Kapasitas (optional)
  max_students Int? // Maksimal siswa yang bisa diterima

  // Relations
  pkl_assignments PKLAssignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([company_name])
  @@index([is_active])
}



enum PKLStatus {
  Active // Sedang berlangsung
  Completed // Selesai
  Cancelled // Dibatalkan
  OnHold // Ditangguhkan
}

enum PKLType {
  Onsite    // Hanya di lokasi industri (wajib GPS di 1 lokasi)
  Remote    // Dari rumah/remote (wajib GPS di lokasi rumah)
  Hybrid    // Fleksibel (bisa di kantor atau rumah)
  Flexible  // Sangat fleksibel (tidak wajib GPS, hanya tap in/out)
}

enum WorkScheduleType {
  Regular    // Jam tetap (08:00-17:00)
  Shift      // Shift (pagi/siang/malam)
  Flexible   // Fleksibel (tidak ada jam tetap)
}

enum LocationType {
  Primary    // Lokasi utama (kantor/industri)
  Secondary  // Lokasi sekunder (rumah/cabang)
  Temporary  // Lokasi sementara (project site, dll)
}

// 2. PKL Assignment
model PKLAssignment {
  id Int @id @default(autoincrement())

  // Siswa
  student_user_id Int
  student         User @relation("PKLStudent", fields: [student_user_id], references: [id])

  // Industry/Perusahaan
  industry_id Int
  industry    Industry @relation(fields: [industry_id], references: [id])

  // Mentor dari Perusahaan (specific untuk assignment ini)
  company_mentor_name  String?
  company_mentor_phone String?
  company_mentor_email String?

  // Periode PKL
  start_date DateTime @db.Date
  end_date   DateTime @db.Date

  // Pembimbing dari Sekolah (Guru Pendamping)
  school_supervisor_id Int?
  school_supervisor    User? @relation("PKLSchoolSupervisor", fields: [school_supervisor_id], references: [id])

  // Target & Notes
  learning_objectives String? @db.Text // Target pembelajaran
  notes               String? @db.Text

  // Status
  status PKLStatus @default(Active)

  // --- NEW FIELDS FOR FLEXIBLE ATTENDANCE ---
  pkl_type PKLType @default(Onsite)
  
  // Work Schedule Settings
  work_schedule_type WorkScheduleType @default(Regular)
  work_start_time    DateTime?         @db.Time
  work_end_time      DateTime?         @db.Time
  
  // GPS Validation Settings
  require_gps_validation Boolean @default(true)

  // Relations
  attendances       PKLAttendance[]
  journals          PKLJournal[]
  allowed_locations PKLAllowedLocation[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([student_user_id, start_date]) // 1 siswa, 1 PKL per periode
  @@index([student_user_id])
  @@index([industry_id])
  @@index([school_supervisor_id])
  @@index([status])
}

model PKLAllowedLocation {
  id                Int           @id @default(autoincrement())
  pkl_assignment_id Int
  pkl_assignment    PKLAssignment @relation(fields: [pkl_assignment_id], references: [id], onDelete: Cascade)

  // Lokasi
  location_name String        // "Kantor PT. XYZ", "Rumah Siswa", "Cabang Jakarta"
  location_type LocationType  @default(Primary)
  latitude      Decimal       @db.Decimal(10, 8)
  longitude     Decimal       @db.Decimal(11, 8)
  radius_meters Int           @default(100)

  // Status
  is_active Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([pkl_assignment_id])
}

// 3. PKL Attendance (Tap In/Out)
model PKLAttendance {
  id                Int           @id @default(autoincrement())
  pkl_assignment_id Int
  pkl_assignment    PKLAssignment @relation(fields: [pkl_assignment_id], references: [id], onDelete: Cascade)

  date DateTime @db.Date

  // Tap In
  tap_in_time   DateTime?
  tap_in_lat    Decimal?  @db.Decimal(10, 8)
  tap_in_lng    Decimal?  @db.Decimal(11, 8)
  tap_in_photo  String? // URL selfie saat tap in (optional)
  tap_in_method String?   @default("Manual") // Manual, GPS, Auto

  // Tap Out
  tap_out_time   DateTime?
  tap_out_lat    Decimal?  @db.Decimal(10, 8)
  tap_out_lng    Decimal?  @db.Decimal(11, 8)
  tap_out_method String?   @default("Manual")

  // Calculated
  total_hours Decimal? @db.Decimal(5, 2) // Jam kerja (auto calculate)

  // Status
  status PKLAttendanceStatus @default(InProgress)

  // Handling "Lupa Tap" - Manual Request
  is_manual_entry Boolean         @default(false) // True jika diajukan manual
  approval_status ApprovalStatus? // Pending, Approved, Rejected
  approved_by_id  Int? // ID guru pembimbing yang approve
  approved_at     DateTime?
  approval_notes  String?         @db.Text

  // Evidence untuk manual entry
  evidence_urls Json? // Array of URLs bukti
  manual_reason String? @db.Text // Alasan lupa tap

  notes String? @db.Text

  // --- NEW FIELDS FOR FLEXIBLE ATTENDANCE ---
  tap_in_location_id  Int?
  tap_out_location_id Int?
  
  tap_in_gps_valid  Boolean @default(false)
  tap_out_gps_valid Boolean @default(false)

  // Relation to journal
  journal PKLJournal?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([pkl_assignment_id, date]) // 1 attendance per day
  @@index([pkl_assignment_id])
  @@index([date])
  @@index([status])
  @@index([approval_status])
}

enum PKLAttendanceStatus {
  Present // Hadir (sudah tap in & out)
  InProgress // Sedang PKL (sudah tap in, belum tap out)
  Absent // Tidak hadir
  Excused // Izin
  Sick // Sakit
}

// 4. PKL Daily Journal
model PKLJournal {
  id                Int           @id @default(autoincrement())
  pkl_assignment_id Int
  pkl_assignment    PKLAssignment @relation(fields: [pkl_assignment_id], references: [id], onDelete: Cascade)

  attendance_id Int           @unique
  attendance    PKLAttendance @relation(fields: [attendance_id], references: [id], onDelete: Cascade)

  date DateTime @db.Date

  // Isi Jurnal
  activities String  @db.Text // Kegiatan yang dilakukan (wajib)
  learnings  String? @db.Text // Apa yang dipelajari (optional)
  challenges String? @db.Text // Kendala yang dihadapi (optional)

  // Media
  photos Json? // Array of photo URLs (optional)

  // Self Assessment
  self_rating Int? // 1-5 (optional)

  // Status
  status       JournalStatus @default(Draft)
  submitted_at DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([pkl_assignment_id])
  @@index([attendance_id])
  @@index([date])
  @@index([status])
}

enum JournalStatus {
  Draft
  Submitted
}

// 5. PKL Settings (Global Config) - Optional
model PKLSettings {
  id Int @id @default(autoincrement())

  // Default Settings
  default_radius_meters       Int      @default(100)
  default_work_start_time     DateTime @db.Time
  default_work_end_time       DateTime @db.Time
  grace_period_tap_in_minutes Int      @default(120) // 2 jam

  // Auto Tap Out Settings
  enable_auto_tapout        Boolean  @default(true)
  auto_tapout_time          DateTime @db.Time
  auto_tapout_default_hours Decimal  @default(8.00) @db.Decimal(4, 2)

  // Validation Rules
  require_gps_validation        Boolean @default(true)
  require_journal_before_tapout Boolean @default(true)
  max_manual_requests_per_month Int     @default(3)

  // Notifications
  enable_reminders        Boolean  @default(true)
  reminder_tap_in_minutes Int      @default(15)
  reminder_journal_time   DateTime @db.Time

  updatedAt DateTime @updatedAt
}
